module.exports = function firstOf() {
  var parsers = []
  parsers.push.apply(parsers, arguments)
  return function(input, pos, cok, cerr, eok, eerr) {
    var presult,
      ppos = pos,
      out = eerr
    function pcok(result, pos) {
      presult = result
      ppos = pos
      out = cok
    }
    function pcerr(result, pos) {
      presult = result
      ppos = pos
      out = cerr
    }

    function peok(result, pos) {
      presult = result
      ppos = pos
      out = eok
    }

    function peerr(result, pos) {
      presult = result
      ppos = pos
      out = eerr
    }
    for (var i in parsers) {
      var p = parsers[i]
      p(input, pos, pcok, pcerr, peok, peerr)
      if (out === cok || out === eok) {
        break
      }
    }
    return out(presult, ppos, input)
  }
}
