var read = require("./read")
var unexpected = require("./unexpected")

/**
 * Calls read if predicate for the current input and pos is true. Otherwise calls
 * eerr with unexpected error.
 * @param {string | number | Callback} predicate - Returns a boolean if the
 * current char code matches the predicate.
 * @param {string} expected - The text that will be displayed in the error
 *  message when the predicate does not match.
 */
module.exports = function char(predicate, expected) {
  if (typeof predicate === "string") {
    return char(predicate.charCodeAt(0), predicate)
  }
  if (typeof predicate === "number") {
    return char(function(c) {
      return c === predicate
    }, expected != null ? expected : predicate)
  }
  return function(input, pos, cok, cerr, eok, eerr) {
    if (predicate(input.charCodeAt(pos))) {
      return read(input, pos, cok, cerr, eok, eerr)
    } else {
      return eerr(
        unexpected(pos, expected, String.fromCharCode(input.charCodeAt(pos))),
        pos,
        input
      )
    }
  }
}
