const resolveCandidates = require("./resolveCandidates")
module.exports = function resolve(symbol, env, scopes = new Set()) {
  if (!env[symbol]) {
    return undefined
  }
  let maxScopes = -1
  let maxBinding
  for (const binding of resolveCandidates(symbol, env, scopes)) {
    const bindingScopes = binding.scopes || new Set()
    if (bindingScopes.size === maxScopes) {
      throw new Error(`Ambiguous binding: ${symbol}`)
    }
    if (bindingScopes.size > maxScopes) {
      maxScopes = bindingScopes.size
      maxBinding = binding
    }
  }
  return maxBinding
}
