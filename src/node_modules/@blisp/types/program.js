const compile = require("@blisp/compiler/compile")
const { program, isExpression, expressionStatement } = require("@babel/types")

// (#%program ((statment) stmt1 ))
function Program(form) {
  return program(
    form[1].map((stmt) => {
      const compiled = compile.call(this, stmt)
      if (isExpression(compiled)) {
        switch (compiled.type) {
          case "FunctionExpression":
            // TODO: verify id
            return { ...compiled, type: "FunctionDeclaration" }
          default:
            return expressionStatement(compiled)
        }
      }
      return compiled
    })
  )
}

module.exports = { [Symbol.for("#%program")]: Program }
