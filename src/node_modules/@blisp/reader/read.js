const peekChar = require("./peek-char")
const readTable = require("./read-table")
const readSymbol = require("./read-symbol")
const readTrivia = require("./read-trivia")
const syntax = require("./syntax")

module.exports = function read(stream) {
  // const start = stream.pos
  let char = peekChar(stream)
  const trivia = readTrivia(stream, char)
  const triviaEnd = stream.pos
  if (stream.eof()) {
    return syntax(trivia, undefined, 0)
  }
  char = peekChar(stream)
  const reader = readTable[char] || readSymbol
  return syntax(trivia, reader(stream, char), stream.pos - triviaEnd)
}
